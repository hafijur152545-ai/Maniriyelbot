<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Maniriyel Bot</title>

<!-- AD -->
<script src='//libtl.com/sdk.js' data-zone='10390731' data-sdk='show_10390731'></script>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body{margin:0;font-family:Segoe UI,sans-serif;background:#f2f4ff;padding-bottom:120px}
.header{background:linear-gradient(135deg,#6d5dfc,#8f9bff);color:#fff;padding:20px;border-radius:0 0 25px 25px}
.card{background:#fff;margin:15px;padding:20px;border-radius:20px;box-shadow:0 10px 25px rgba(0,0,0,.1)}
.balance{font-size:36px;font-weight:700}
.btn{width:100%;padding:14px;margin-top:10px;border:none;border-radius:14px;background:#2f3437;color:#fff;font-size:16px}
input,select{width:100%;padding:12px;margin-top:10px;border-radius:10px;border:1px solid #ccc}
.screen{display:none}
.screen.active{display:block}
.nav{position:fixed;bottom:10px;left:10px;right:10px;background:#2f3437;border-radius:20px;padding:12px;display:flex;justify-content:space-around;color:#bbb}
.nav span{font-size:22px}
.nav .active{color:#fff}
</style>
</head>

<body>

<div class="header">
  <h2>üí∞ Earn Money Bot</h2>
  <small id="userInfo">User</small>
</div>

<!-- HOME -->
<div id="home" class="screen active">
  <div class="card">
    <div class="balance" id="balance">0.00 ‡ß≥</div>
    <small>Total Balance</small>
  </div>
  <div class="card">
    <button class="btn" onclick="copyReferral()">üë• Referral Link</button>
  </div>
</div>

<!-- EARN -->
<div id="earn" class="screen">
  <div class="card">
    <button class="btn" onclick="watchAd()">üì∫ Watch Ad (+2‡ß≥)</button>
  </div>
</div>

<!-- WITHDRAW -->
<div id="withdraw" class="screen">
  <div class="card">
    <h3>üí∏ Withdraw</h3>
    <select id="method">
      <option value="">Select Method</option>
      <option>Bkash</option>
      <option>Nagad</option>
      <option>Rocket</option>
    </select>
    <input id="number" placeholder="Payment Number">
    <input id="amount" type="number" placeholder="Amount">
    <button class="btn" onclick="submitWithdraw()">Submit Withdraw</button>
  </div>
</div>

<!-- HISTORY -->
<div id="history" class="screen">
  <div class="card">
    <h3>üßæ History</h3>
    <div id="historyList">No history</div>
  </div>
</div>

<!-- NAV -->
<div class="nav">
  <span onclick="showScreen('home',this)" class="active">üè†</span>
  <span onclick="showScreen('earn',this)">üé¨</span>
  <span onclick="showScreen('withdraw',this)">üí∏</span>
  <span onclick="showScreen('history',this)">üßæ</span>
</div>

<script>
/* CONFIG */
const BOT_TOKEN="8547593478:AAHfAaZNdh6-gii36zff0DqIAxuuuHQUwd0";
const ADMIN_ID="6560485203";
const AD_REWARD=2;
const REF_PERCENT=0.10;
const MIN_WITHDRAW=20;

const tg=window.Telegram.WebApp;
tg.expand();

let user=tg.initDataUnsafe.user;
let balance=Number(localStorage.getItem("balance")||0);
let history=JSON.parse(localStorage.getItem("history")||"[]");

document.getElementById("balance").innerText=balance.toFixed(2)+" ‡ß≥";
document.getElementById("userInfo").innerText=user.first_name+" | ID:"+user.id;

/* REFERRAL */
let refId=new URLSearchParams(window.location.search).get("start");
if(refId && !localStorage.getItem("referred")){
  localStorage.setItem("referred",refId);
}

/* NAV */
function showScreen(id,el){
  document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  document.querySelectorAll(".nav span").forEach(n=>n.classList.remove("active"));
  el.classList.add("active");
}

/* AD */
function watchAd(){
  if(typeof show_10390731!=="function"){alert("Ad not ready");return;}
  show_10390731().then(()=>{
    balance+=AD_REWARD;
    localStorage.setItem("balance",balance);
    document.getElementById("balance").innerText=balance.toFixed(2)+" ‡ß≥";

    if(localStorage.getItem("referred")){
      let bonus=AD_REWARD*REF_PERCENT;
      fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${ADMIN_ID}&text=`+
      encodeURIComponent(`Referral Bonus\nReferrer ID:${localStorage.getItem("referred")}\nBonus:${bonus}‡ß≥`));
    }
  });
}

/* WITHDRAW */
function submitWithdraw(){
  let m=method.value,n=number.value,a=Number(amount.value);
  if(!m||!n||!a)return alert("Fill all");
  if(a<MIN_WITHDRAW)return alert("Minimum 20‡ß≥");
  if(a>balance)return alert("Low balance");

  fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${ADMIN_ID}&text=`+
  encodeURIComponent(`Withdraw\nUser:${user.id}\n${m}\n${n}\nAmount:${a}‡ß≥`));

  balance-=a;
  localStorage.setItem("balance",balance);
  document.getElementById("balance").innerText=balance.toFixed(2)+" ‡ß≥";

  history.push(`${m} | ${a}‡ß≥`);
  localStorage.setItem("history",JSON.stringify(history));
  renderHistory();
  alert("Withdraw Sent");
}

/* HISTORY */
function renderHistory(){
  historyList.innerHTML=history.length?history.map(h=>`<p>${h}</p>`).join(""):"No history";
}
renderHistory();

/* REF LINK */
function copyReferral(){
  let link=`https://t.me/maniriyel_bot?start=${user.id}`;
  navigator.clipboard.writeText(link);
  alert("Referral link copied");
}
</script>
</body>
</html>
