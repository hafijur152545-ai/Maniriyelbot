<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:Arial;background:#f2f3f7;margin:0}
.header{background:#222;color:#fff;padding:15px;text-align:center}
.card{background:#fff;margin:10px;padding:12px;border-radius:10px}
.btn{padding:10px;border:none;border-radius:6px;color:#fff;cursor:pointer;margin:3px 0;width:100%}
.toggle{background:#3f51b5}
.approve{background:#28a745}
.reject{background:#d32f2f}
.edit{background:#ff9800}
.save{background:#009688}
.small{font-size:13px;color:#555}
input{width:100%;padding:8px;margin:5px 0}
</style>
</head>

<body>

<div class="header">ğŸ‘‘ Admin Panel</div>

<!-- BOT -->
<div class="card">
  <button class="btn toggle" onclick="toggleBot()">ğŸ”„ Bot ON / OFF</button>
  <div class="small" id="botStatus">Loading...</div>
</div>

<!-- TODAY REPORT -->
<div class="card">
  <h3>ğŸ“Š Today Report</h3>
  <div class="small" id="todayEarn">Today Earned: 0à§³</div>
</div>

<!-- USER CONTROL -->
<div class="card">
  <h3>ğŸ‘¤ User Balance Control</h3>
  <input id="uidInput" placeholder="User UID (Telegram chat_id)">
  <input id="balanceInput" type="number" placeholder="Amount">
  <button class="btn edit" onclick="addBalance()">â• Add Balance</button>
  <button class="btn reject" onclick="setBalance()">âœï¸ Set Balance</button>
  <div class="small" id="userInfo"></div>
</div>

<!-- WITHDRAW -->
<div class="card">
  <h3>â³ Pending Withdraw</h3>
  <div id="withdrawList" class="small">Loading...</div>
</div>

<!-- AD REWARD CONTROL -->
<div class="card">
  <h3>ğŸ“¢ Ad Reward Control</h3>
  <input type="number" id="adAmount" placeholder="Reward Amount (à§³)">
  <button class="btn toggle" onclick="toggleAd()">ğŸ”˜ ON / OFF</button>
  <button class="btn save" onclick="saveAd()">ğŸ’¾ Save</button>
  <div class="small" id="adStatus">Loading...</div>
</div>

<!-- âœ… NEW 1 : DAILY AD LIMIT -->
<div class="card">
  <h3>ğŸ“† Daily Ad Limit</h3>
  <input type="number" id="dailyAdLimit" placeholder="Daily Ad Limit">
  <button class="btn save" onclick="saveDailyLimit()">ğŸ’¾ Save</button>
  <div class="small" id="dailyLimitStatus">Loading...</div>
</div>

<!-- âœ… NEW 2 : MIN WITHDRAW -->
<div class="card">
  <h3>ğŸ’¸ Minimum Withdraw Amount</h3>
  <input type="number" id="minWithdraw" placeholder="Minimum Withdraw (à§³)">
  <button class="btn save" onclick="saveMinWithdraw()">ğŸ’¾ Save</button>
  <div class="small" id="minWithdrawStatus">Loading...</div>
</div>

<!-- âœ… NEW 3 : USER BAN -->
<div class="card">
  <h3>ğŸš« User Ban / Unblock</h3>
  <input id="banUid" placeholder="User UID">
  <button class="btn reject" onclick="banUser()">ğŸš« Ban</button>
  <button class="btn approve" onclick="unbanUser()">âœ… Unban</button>
  <div class="small" id="banStatus"></div>
</div>

<!-- âœ… NEW 4 : USER COUNTRY -->
<div class="card">
  <h3>ğŸŒ User Country Check</h3>
  <input id="countryUid" placeholder="User UID">
  <button class="btn toggle" onclick="loadCountry()">ğŸ” Check</button>
  <div class="small" id="countryResult"></div>
</div>

<script type="module">
/* ================= ğŸ” PIN SECURITY ================= */
const ADMIN_PIN="1525";
let wrongCount=Number(localStorage.getItem("pinWrong")||0);
let lockedUntil=Number(localStorage.getItem("pinLockUntil")||0);
let permanentLock=localStorage.getItem("pinPermanent")==="yes";
const now=Date.now();

if(permanentLock){
 document.body.innerHTML="<h2 style='text-align:center;margin-top:80px'>ğŸš« Permanently Locked</h2>";
 throw "";
}
if(lockedUntil>now){
 const m=Math.ceil((lockedUntil-now)/60000);
 document.body.innerHTML=`<h2 style='text-align:center;margin-top:80px'>â³ ${m} à¦®à¦¿à¦¨à¦¿à¦Ÿ à¦…à¦ªà§‡à¦•à§à¦·à¦¾ à¦•à¦°à§‹</h2>`;
 throw "";
}
const pin=prompt("ğŸ” Enter Admin PIN");
if(pin!==ADMIN_PIN){
 wrongCount++; localStorage.setItem("pinWrong",wrongCount);
 if(wrongCount>=10){
  localStorage.setItem("pinPermanent","yes");
  throw "";
 }
 if(wrongCount>=3){
  localStorage.setItem("pinLockUntil",now+10*60*1000);
  throw "";
 }
 throw "";
}
localStorage.removeItem("pinWrong");
localStorage.removeItem("pinLockUntil");

/* ================= FIREBASE ================= */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, onValue, update, get }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig={
 apiKey:"AIzaSyDBSUP7tfK5IlvEEoDm3qwkMhH6MU8Q3jE",
 authDomain:"maniriyelbot0.firebaseapp.com",
 databaseURL:"https://maniriyelbot0-default-rtdb.asia-southeast1.firebasedatabase.app",
 projectId:"maniriyelbot0",
 storageBucket:"maniriyelbot0.firebasestorage.app",
 messagingSenderId:"386824179846",
 appId:"1:386824179846:web:e6eadd434a3151e48e0107"
};

const app=initializeApp(firebaseConfig);
const db=getDatabase(app);

/* ================= BOT ================= */
const botRef=ref(db,"settings/bot");
onValue(botRef,s=>{
 botStatus.innerText="Current Status: "+(s.val()||"on");
});
window.toggleBot=async()=>{
 const s=await get(botRef);
 update(ref(db,"settings"),{bot:s.val()==="on"?"off":"on"});
};

/* ================= AD REWARD ================= */
const adRef=ref(db,"settings/adReward");
onValue(adRef,s=>{
 const d=s.val()||{};
 adAmount.value=d.amount||0;
 adStatus.innerText="Status: "+(d.status||"off");
});
window.toggleAd=async()=>{
 const s=await get(adRef);
 update(adRef,{status:s.val()?.status==="on"?"off":"on"});
};
window.saveAd=()=>{
 update(adRef,{amount:Number(adAmount.value)||0});
};

/* ================= DAILY AD LIMIT ================= */
const limitRef=ref(db,"settings/dailyAdLimit");
onValue(limitRef,s=>{
 dailyAdLimit.value=s.val()||0;
 dailyLimitStatus.innerText="Current: "+(s.val()||0);
});
window.saveDailyLimit=()=>{
 update(ref(db,"settings"),{dailyAdLimit:Number(dailyAdLimit.value)||0});
};

/* ================= MIN WITHDRAW ================= */
const minWRef=ref(db,"settings/minWithdraw");
onValue(minWRef,s=>{
 minWithdraw.value=s.val()||0;
 minWithdrawStatus.innerText="Current: "+(s.val()||0)+"à§³";
});
window.saveMinWithdraw=()=>{
 update(ref(db,"settings"),{minWithdraw:Number(minWithdraw.value)||0});
};

/* ================= USER ================= */
async function loadUser(uid){
 const s=await get(ref(db,"users/"+uid));
 if(!s.exists()){userInfo.innerText="âŒ User not found";return null;}
 const d=s.val();
 userInfo.innerHTML=`ğŸ’° Balance: ${d.balance||0}à§³`;
 return d;
}
window.addBalance=async()=>{
 const uid=uidInput.value.trim();
 const amt=Number(balanceInput.value);
 if(!uid||!amt)return;
 const d=await loadUser(uid); if(!d)return;
 update(ref(db,"users/"+uid),{balance:(d.balance||0)+amt});
};
window.setBalance=async()=>{
 const uid=uidInput.value.trim();
 const amt=Number(balanceInput.value);
 if(!uid)return;
 update(ref(db,"users/"+uid),{balance:amt});
 loadUser(uid);
};

/* ================= USER BAN ================= */
window.banUser=async()=>{
 const uid=banUid.value.trim();
 if(!uid)return;
 await update(ref(db,"users/"+uid),{banned:true});
 banStatus.innerText="ğŸš« User Banned";
};
window.unbanUser=async()=>{
 const uid=banUid.value.trim();
 if(!uid)return;
 await update(ref(db,"users/"+uid),{banned:false});
 banStatus.innerText="âœ… User Unbanned";
};

/* ================= USER COUNTRY ================= */
window.loadCountry=async()=>{
 const uid=countryUid.value.trim();
 if(!uid)return;
 const s=await get(ref(db,"users/"+uid+"/country"));
 countryResult.innerText=s.exists()?"ğŸŒ Country: "+s.val():"âŒ Country not found";
};

/* ================= WITHDRAW ================= */
onValue(ref(db,"withdraws"),snap=>{
 withdrawList.innerHTML="";
 if(!snap.exists()){withdrawList.innerText="à¦•à§‹à¦¨à§‹ à¦°à¦¿à¦•à§‹à§Ÿà§‡à¦¸à§à¦Ÿ à¦¨à§‡à¦‡";return;}
 snap.forEach(s=>{
  const d=s.val();
  if(d.status!=="pending")return;
  withdrawList.innerHTML+=`
  <div class="card">
   ğŸ‘¤ ${d.uid}<br>ğŸ’° ${d.amount}à§³<br>
   <button class="btn approve" onclick="approve('${s.key}')">Approve</button>
   <button class="btn reject" onclick="rejectReq('${s.key}')">Reject</button>
  </div>`;
 });
});
window.approve=id=>update(ref(db,"withdraws/"+id),{status:"approved"});
window.rejectReq=id=>update(ref(db,"withdraws/"+id),{status:"rejected"});
</script>

</body>
</html>
